(()=>{var T={calculateEventPosition:(c,t)=>{if(t==="viewport")return c.target.getBoundingClientRect();if(t==="body"){let e=function(r,i){var a=0;do isNaN(r?.["offset"+i])||(a+=r?.["offset"+i]);while(r=r?.offsetParent);return a};return{top:e(c.target,"Top"),left:e(c.target,"Left"),right:e(c.target,"Right"),bottom:e(c.target,"Bottom"),width:c.target.getBoundingClientRect().width,height:c.target.getBoundingClientRect().height}}},insertContextMenu:c=>{let t=!wp.data.select("getgenie").contextMenu().open;wp.data.dispatch("getgenie").setContextMenu({open:t,buttonEvent:c})},showSidebar:c=>{let t=wp.data.select("getgenie").sidebar().existingInputValue||"",e="WriteTemplatesScreen",n=c.slug;n==="list"&&(e="TemplateListScreen"),wp.data.dispatch("getgenie").setContextMenu({open:!1}),wp.data.dispatch("getgenie").setSidebar({open:!0,currentWritingMode:c?.mode,component:e,currentTemplate:n,existingInputValue:t.replace(/<br\s*[\/]?>/g,"")})}},f=T;var C=`${window.getGenie.config.assetsUrl}dist/admin/images/genie-dark.svg`,p=class{getUpperSiblingsWithInnerText=t=>{let e=[],n=t.previousSibling;for(;n;)n.nodeType===Node.ELEMENT_NODE&&!n.classList.contains("blog-title")&&e.unshift(n.innerText+" "),n=n.previousSibling;return e.join("")};triggerBtnHtml=(t,e)=>{let n=document.createElement("button"),r=window.getComputedStyle(e),i=parseInt(r.paddingBottom)||0,a=parseInt(r.marginBottom)||0,o=parseInt(r.borderBottomWidth)||0;return t?.includes("bricks")&&(n.style.top=`-${a+o+i+38}px`),(t?.includes("oxygen")||t?.includes("cpt"))&&(n.style.top=`-${a+o+i+25}px`),t?.includes("elementor")&&elementor.settings.editorPreferences.model.get("ui_theme")==="auto"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&n.classList.add("dark"),n.classList.add("getgenie-trigger-btn",t),n.innerHTML=`<img src=${C} alt="GetGenie" />`,n};checkVisibility=t=>{let e=window.getComputedStyle(t),n=e.display,r=e.visibility;return!(n==="none"||r==="hidden")};addGetGenieTriggerBtn=(t,e,n=!0)=>{if(!t)return;setTimeout(()=>{let i=jQuery(t).find(".mce-container");if(i?.length){if(this.checkVisibility(i[0])){i.parent().find(`.${e}`).length&&i.parent().find(`.${e}`).remove();let o=i.find("iframe");o[0].insertAdjacentElement("afterend",this.triggerBtnHtml(`${e}`,o[0]))}let a=i.parent().find("textarea");if(!a?.length||!this.checkVisibility(a[0]))return;a.parent().find(`.${e}`).length&&(a.parent().find(`.${e}`).remove(),a[0].insertAdjacentElement("afterend",this.triggerBtnHtml(`${e}`,a[0])))}},500);let r=n?jQuery(t).find("textarea"):jQuery(t);!r?.length||r.parent().find(`.${e}`).length||r.each((i,a)=>{!this.checkVisibility(a)||a.insertAdjacentElement("afterend",this.triggerBtnHtml(`${e}`,a))})};addGetGenieTriggerBtnForOxygen=t=>{if(!t)return;let e=jQuery(t).find(".textarea");if(!e.length&&jQuery(t).find("#wp-oxygen_vsb_tinymce-wrap").length){let n=jQuery(t).find("textarea.wp-editor-area"),r=jQuery(t).find(".mce-container");if(r?.length&&this.checkVisibility(r[0])){let i=r.find("iframe");r.parent().find(".getGenie-oxygen-iframe").length&&r.parent().find(".getGenie-oxygen-iframe").remove(),i[0].insertAdjacentElement("beforeBegin",this.triggerBtnHtml("getGenie-oxygen-iframe",i[0]))}n?.length&&this.checkVisibility(n[0])&&(n.parent().find(".getGenie-oxygen-iframe").length&&n.parent().find(".getGenie-oxygen-iframe").remove(),n[0].insertAdjacentElement("beforeBegin",this.triggerBtnHtml("getGenie-oxygen-iframe",n[0])))}!e?.length||e.parent().find(".getGenie-oxygen-textarea").length||e.each((n,r)=>{!this.checkVisibility(r)||r.insertAdjacentElement("afterend",this.triggerBtnHtml("getGenie-oxygen-textarea",r))})};addGetGenieTriggerBtnForFluentCRM=(t,e)=>{if(!t)return;if(t.querySelector(".getGenie-fluent-editorField")||t.appendChild(this.triggerBtnHtml(`${e}`,t)),t.className==="wp-editor-container"){let r=jQuery(t).find(".mce-container");if(r?.length&&this.checkVisibility(r[0])){let i=r.find("iframe");r.parent().find(".getGenie-fluent-iframe").length&&r.parent().find(".getGenie-fluent-iframe").remove(),i[0].insertAdjacentElement("beforeBegin",this.triggerBtnHtml("getGenie-fluent-iframe",i[0]))}}};insertTextToInputs=(t,e)=>{let n=t.replace(/<br\s*[\/]?>/g,`
`),r=new KeyboardEvent("keydown",{key:"Shift",bubbles:!0,cancelable:!0});if(wp.data.select("getgenie").sidebar().currentTemplate==="expandOutline")if(e?.tagName==="TEXTAREA"||e?.tagName==="DIV")e.value=n,r=new Event("input",{bubbles:!0,cancelable:!0});else{let a=t.replace(/(\<br[\s]*\/?\>[\s]*)+/g,"<br>").split("<br>");for(let o of a){let l=document.createElement("p");l.textContent=o,e.insertAdjacentElement("afterend",l),e=e.nextElementSibling}}else["INPUT","TEXTAREA"].includes(e?.tagName)?(e.value=n,r=new Event("input",{bubbles:!0,cancelable:!0})):e?.tagName==="DIV"?(e.innerText=n,r=new Event("input",{bubbles:!0,cancelable:!0})):e.innerText=n;e.dispatchEvent(r)};contextMenuCallback={continueWriting:(t,e,{beforeCaret:n,selectedText:r,afterCaret:i})=>{let a=this.getUpperSiblingsWithInnerText(e);a?.length&&(n=a+n);let o=t;r[r?.length-1]!==" "&&(o=" "+o),this.insertTextToInputs(n+r+o+i,e)},expandOutline:(t,e,{beforeCaret:n,selectedText:r,afterCaret:i})=>{let a;e?.tagName==="DIV"||e?.tagName==="TEXTAREA"?a=n+r+" "+t+`
`+i:a=t,this.insertTextToInputs(a,e)},rewrite:(t,e,{beforeCaret:n,afterCaret:r})=>{let i=n;n&&(i+=" "),i+=t+" "+r,this.insertTextToInputs(i,e)}};genieHeadClickHandler=(t,e,n=null)=>{jQuery(document).on("click",".getgenie-trigger-btn",function(r){r.preventDefault();let i=jQuery(this).siblings("textarea").length?jQuery(this).siblings("textarea"):jQuery(this).siblings("iframe");if(n=="oxygen"&&(i=jQuery(this).siblings(".textarea")?.find('[contenteditable="true"]'),!i?.length&&jQuery(this).parents(".oxygen-tinymce-dialog-wrap").length&&(i=jQuery(this).siblings("textarea").length?jQuery(this).siblings("textarea"):jQuery(this).siblings("iframe"))),n=="cpt"&&(i=jQuery(this).siblings("textarea,  input[type=text]").length?jQuery(this).siblings("textarea,  input[type=text]"):jQuery(this).siblings("iframe")),jQuery(this)?.[0]?.id==="genie-head-cpt"&&(i=jQuery(this).closest("#wp-content-editor-tools").siblings("#wp-content-editor-container")),n=="fluent-crm"&&(i=jQuery(this).children(".is-root-container")),i.length==0)return;let a=i[0]?.value;i=i?.[0];let o=(a||"").substring(0,i?.selectionStart),l=(a||"").substring(i?.selectionEnd),u,g,s=window.getSelection(),d=s.toString(),h=i.tagName.toLowerCase();if(i?.id==="wp-content-editor-container")if(jQuery(i).find("textarea").css("display")==="none"){let m=document.querySelector("#content_ifr").contentWindow,v=m.document.querySelector("body :first-child");s=m.document.getSelection(),d=s.toString(),s?.focusNode&&(i=s.focusNode.parentNode,a=i.innerText,u=Math.min(s?.focusOffset,s?.baseOffset),g=Math.max(s?.focusOffset,s?.baseOffset),o=a.substring(0,u),l=a.substring(g))}else i=jQuery(i).find("textarea")[0],a=i.value,d=s.toString(),o=(a||"").substring(0,i?.selectionStart),l=(a||"").substring(i?.selectionEnd);else if(h==="div"||h==="iframe"){if(h==="iframe"){let b=i.contentWindow,m=b.document;jQuery(m).on("click",function(x){x.preventDefault(),wp.data.select("getgenie").contextMenu()?.open&&wp.data.dispatch("getgenie").setContextMenu({open:!1})}),s=b.getSelection()}d=s?.toString(),s?.focusNode&&(i=s.focusNode.parentNode,a=i.innerText,u=Math.min(s?.focusOffset,s?.baseOffset),g=Math.max(s?.focusOffset,s?.baseOffset),o=a?.substring(0,u),l=a?.substring(g))}else h=="textarea"&&(a=i?.value,o=(a||"").substring(0,i?.selectionStart),l=(a||"").substring(i?.selectionEnd),d=s.toString());let w=f.calculateEventPosition(r,"viewport");f.insertContextMenu(w),s?.focusNode&&(wp.data.dispatch("getgenie").setSidebar({insertTextCallback:e,insertTextField:i,existingInputValue:d}),wp.data.dispatch("getgenie").setContextMenu({inputContent:{beforeCaret:o,selectedText:d,afterCaret:l},insertionField:i,contextMenuCallback:t}))})};genieHeadClickHandlerForWebview=(t,e)=>{setTimeout(()=>{let n=document.querySelector(".ql-editor");n&&(wp.data.dispatch("getgenie").setContextMenu({insertionField:n.firstChild,contextMenuCallback:t}),this.webviewScriptHandler.searchCallback(n.firstChild))},2e3),jQuery(document).on("click",".getgenie-trigger-btn",function(n){n.preventDefault();let r,i=f.calculateEventPosition(n,"viewport");f.insertContextMenu(i);let a,o,l=window.getSelection();l?.focusNode?r=l.focusNode?.nodeName==="#text"?l.focusNode.parentNode:l.focusNode:r=document.querySelector(".ql-editor").lastChild;let u=r.textContent,g="",s="",d="";l?.focusNode&&(g=l.toString(),a=Math.min(l?.focusOffset,l?.baseOffset),o=Math.max(l?.focusOffset,l?.baseOffset),s=u.substring(0,a),d=u.substring(o)),wp.data.dispatch("getgenie").setSidebar({insertTextCallback:e,insertTextField:r,existingInputValue:g}),wp.data.dispatch("getgenie").setContextMenu({inputContent:{beforeCaret:s,selectedText:g,afterCaret:d},insertionField:r,contextMenuCallback:t})})};webviewSearchCallback=(t,e)=>{wp.data.dispatch("getgenie").setSidebar({insertTextCallback:e,insertTextField:t,existingInputValue:""})};bricksScriptHandler={init:(t,e)=>{this.addGetGenieTriggerBtn(t,e)},clickHandler:()=>this.genieHeadClickHandler(this.contextMenuCallback,this.insertTextToInputs)};oxygenScriptHandler={init:t=>{this.addGetGenieTriggerBtnForOxygen(t)},clickHandler:()=>this.genieHeadClickHandler(this.contextMenuCallback,this.insertTextToInputs,"oxygen")};elementorScriptHandler={init:(t,e)=>{this.addGetGenieTriggerBtn(t,e)},clickHandler:()=>this.genieHeadClickHandler(this.contextMenuCallback,this.insertTextToInputs)};tmceBtnClickHandler=(t,e,n)=>{document.querySelector("#content-tmce")&&(document.querySelector("#content-tmce").addEventListener("click",function(){t(e,n)}),document.querySelector("#content-html").addEventListener("click",function(){t(e,n)}))};cptScriptHandler={init:(t,e,n=!0)=>{this.addGetGenieTriggerBtn(t,e,n),this.tmceBtnClickHandler(this.addGetGenieTriggerBtn,t,e)},clickHandler:()=>this.genieHeadClickHandler(this.contextMenuCallback,this.insertTextToInputs,"cpt")};webviewScriptHandler={clickHandler:()=>this.genieHeadClickHandlerForWebview(this.contextMenuCallback,this.insertTextToInputs),searchCallback:t=>this.webviewSearchCallback(t,this.insertTextToInputs)};fluentcrmScriptHandler={init:(t,e)=>{this.addGetGenieTriggerBtnForFluentCRM(t,e)},clickHandler:()=>this.genieHeadClickHandler(this.contextMenuCallback,this.insertTextToInputs,"fluent-crm")}};var y=new p;jQuery(document).ready(function(c){MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var t=new MutationObserver(function(e,n){for(let r of e)y.elementorScriptHandler.init(document.getElementById("elementor-panel"),"getGenie-elementor-textarea"),wp.data.select("getgenie").contextMenu()?.open&&wp.data.dispatch("getgenie").setContextMenu({open:!1})});t.observe(document.getElementById("elementor-panel"),{subtree:!0,attributeFilter:["class"],attributes:!0}),y.bricksScriptHandler.clickHandler()});})();
